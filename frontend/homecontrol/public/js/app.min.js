(function (angular) {
    'use scrict';

    var homeApp = angular.module("homeDashboard", ["ngRoute"]);

    homeApp.config(["$routeProvider",
        function ($routeProvider) {
            $routeProvider.
                when("/dashboard", {
                    templateUrl: "app/partials/dashboard.html",
                    controller: "dashboardController"
                })
                .otherwise({
                    redirectTo: "/dashboard"
                });
        }]);

    homeApp.factory('weatherService', function ($http) {
        return {
            getWeather: function () {
                var weather = { temp: {}, clouds: null };
                $http.jsonp('http://api.openweathermap.org/data/2.5/weather?q=Salzburg,at&units=metric&callback=JSON_CALLBACK').success(function (data) {
                    if (data) {
                        if (data.main) {
                            weather.temp.current = data.main.temp;
                            weather.temp.min = data.main.temp_min;
                            weather.temp.max = data.main.temp_max;
                        }
                        weather.clouds = data.clouds ? data.clouds.all : undefined;
                    }
                });

                return weather;
            }
        };
    });

    homeApp.filter('temp', function ($filter) {
        return function (input, precision) {
            if (!precision) {
                precision = 1;
            }
            var numberFilter = $filter('number');
            return numberFilter(input, precision) + '\u00B0C';
        };
    });

    homeApp.controller('WeatherCtrl', function ($scope, weatherService) {
        $scope.weather = weatherService.getWeather();
    });

    homeApp.directive('weatherIcon', function () {
        return {
            restrict: 'E', replace: true,
            scope: {
                cloudiness: '@'
            },
            controller: function ($scope) {
                $scope.imgurl = function () {
                    var baseUrl = 'https://ssl.gstatic.com/onebox/weather/128/';
                    if ($scope.cloudiness < 20) {
                        return baseUrl + 'sunny.png';
                    } else if ($scope.cloudiness < 90) {
                        return baseUrl + 'partly_cloudy.png';
                    } else {
                        return baseUrl + 'cloudy.png';
                    }
                };
            },
            template: '<div style="float:left"><img ng-src="{{ imgurl() }}"></div>'
        };
    });

})(angular);
(function (angular) {

    var appUrl = "api/app";

    function AppService($http) {

        


        function getAppInformation(callback) {
            
            var url = '/weather';
            $http({
                url: url
            })
            .success(function (data) {
                console.log(data);
            })
            .error(function (data) {
                
            });
            
            $http.get(appUrl)
                .success(function (data) {
                    callback(null, data);
                })
                .error(function (data) {
                    callback(data, null);
                });
        }

        return {
            getAppInformation: getAppInformation
        };
    }

    AppService.$inject = ["$http"];

    angular.module("homeDashboard")
        .factory("appService", AppService);

})(angular);
(function (angular) {

    var dashboardUrl = "api/dashboard";

    function dashboardService($http) {

        return null;
    }

    dashboardService.$inject = ["$http"];

    angular.module("homeDashboard")
        .factory("dashboardService", dashboardService);

})(angular);
(function (angular) {
    "use strict";

    function appController(appService, $scope) {

        function getAppInformation() {
            appService.getAppInformation(function (error, data) {
                $scope.appInformation = data.appInformation;
            });
        }

        getAppInformation();
    }

    appController.$inject = ['appService', '$scope'];

    angular.module('homeDashboard')
        .controller('appController', appController);

})(angular);
(function (angular) {
    "use strict";

    function dashboardController(dashboardService, $scope) {
    }

    dashboardController.$inject = ["dashboardService", "$scope"];

    angular.module("homeDashboard")
        .controller("dashboardController", dashboardController);

})(angular);
(function (angular) {
    "use strict";

    function TimeController($scope, $timeout) {
        $scope.clock = "loading clock..."; // initialise the time variable
        $scope.tickInterval = 1000; //ms

        var tick = function () {
            $scope.clock = Date.now(); // get the current time
            $timeout(tick, $scope.tickInterval); // reset the timer
        };

        // Start the timer
        $timeout(tick, $scope.tickInterval);
    }

    angular.module("homeDashboard")
        .controller("TimeController", TimeController);

})(angular);